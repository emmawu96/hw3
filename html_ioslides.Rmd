---
title: "MA 415/ MA615 
        HW 3 Section 1 project"
output: ioslides_presentation
fontsize: 10pt
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

## Team members

- Yue Wu 
- Yin Chia Huang 
- Francesco Ignazio Re

## Outline

- Introduction
- Summary of the data set 
- Descriptive Data Analysis
- Simple statistic tests
- Data visualization
- Conclusion

## Introduction

Apprehensions at the US-Mexico border have declined to near-historic lows over the last few years. The objective of this report is to give a deeper insight on this change that is been occuring. Through the analysis of the data collected by the U.S. Customs and Border Protection through the years, we intend to shed light on the general trend's behaviour of this phenomenon, focusing on how factors such as time and place have influenced the given outcome.


```{r include=FALSE}
# Raw Data
PB2010 <- read.csv("PB2010.csv")
PB2017 <- read.csv("PB2017.csv")
ap10 <- read.csv("BP apprehensions 2010.csv")
ap17 <- read.csv("edited_app17.csv")

```


## Over view of 2010 Apprehensions
The gray dots are Sector "Tucson", which had the most unstable number of apprehensions. And it also contributed the most apprehensions in 2010. 
```{r}
#PB2010 <- read.csv("PB2010.csv")
plot(PB2010$Month, PB2010$Apprehensions, col = PB2010$Sector)

# install.packages("tidyverse")
# library(tidyverse)
# 
# ggplot(data = PB2010) + 
#   geom_point(mapping = aes(x = Month, y = Apprehensions , color = Sector))
```

## Overview of 2017 Apprehensions
The pink dots are Sector "Rio Grande Valley" which contributed the most apprehensions in 2017. Notably,the number of apprehensions from Rio Grande Valley was unstable, especially it dramatically increased from September to October.

```{r}
#PB2017 <- read.csv("PB2017.csv")
plot(PB2017$Month, PB2017$Apprehensions, col = PB2017$Sector)

# install.packages("tidyverse")
# library(tidyverse)
# 
# ggplot(data = PB2017) + 
#   geom_point(mapping = aes(x = Month, y = Apprehensions , color = Sector))
```

## Statistic number of 2010 by month 
```{r}
#mean
mean_10_mon <- tapply(PB2010$Apprehensions, PB2010$Month, mean)
#median 
median_10_mon <- tapply(PB2010$Apprehensions, PB2010$Month, median)
# variance
var_10_mon <- tapply(PB2010$Apprehensions, PB2010$Month, var)
```

```{r}
PB10_statInfo_byMon <- data.frame(Mean = mean_10_mon, Median = median_10_mon, Variance = var_10_mon)
PB10_statInfo_byMon
```

## Statistic number of 2017 by month 
```{r}
#mean
mean_17_mon <- tapply(PB2017$Apprehensions, PB2017$Month, mean)
#median 
median_17_mon <- tapply(PB2017$Apprehensions, PB2017$Month, median)
# variance
var_17_mon <- tapply(PB2017$Apprehensions, PB2017$Month, var)
```

```{r}
PB17_statInfo_byMon <- data.frame(Mean = mean_17_mon, Median = median_17_mon, Variance = var_17_mon)
PB17_statInfo_byMon
```

## Statistic number of 2010 by sector 
 
```{r}
#mean
mean_10_sec <- tapply(PB2010$Apprehensions, PB2010$Sector, mean)
#median 
median_10_sec <- tapply(PB2010$Apprehensions, PB2010$Sector, median)
# variance
var_10_sec <- tapply(PB2010$Apprehensions, PB2010$Sector, var)
```

```{r}
PB10_statInfo_bySec <- data.frame(Mean = mean_10_sec, Median = median_10_sec, Variance = var_10_sec)
PB10_statInfo_bySec
```
## Statistic number of 2017 by sector 
```{r}
#mean
mean_17_sec <- tapply(PB2017$Apprehensions, PB2017$Sector, mean)
#median 
median_17_sec <- tapply(PB2017$Apprehensions, PB2017$Sector, median)
# variance
var_17_sec <- tapply(PB2017$Apprehensions, PB2017$Sector, var)
```

```{r}
PB17_statInfo_bySec <- data.frame(Mean = mean_17_sec, Median = median_17_sec, Variance = var_17_sec)
PB17_statInfo_bySec
```

## 2010 v.s 2017 Apprehensions by month  
The most 3 trafficated months in 2010, April, May and June, are also the ones that have witnessed the greatest decline, figuring the lowest numbers in the data collected in 2017.
While apprehensions tend to decrease during the winter months, we can see an increase from January to March from 2010 to 2017.
```{r echo=FALSE}
#ap10 <- read.csv("BP apprehensions 2010.csv")
cities <- ap10[,1]
ap10 <- ap10[-c(1,14)]
rownames(ap10) <- cities
SumCol10 <- colSums(Filter(is.numeric, ap10))
#ap17 <- read.csv("edited_app17.csv")
ap17 <- ap17[-c(1,2,15)]
rownames(ap17) <- cities
SumCol17 <- colSums(Filter(is.numeric, ap17))
CmbColS <- rbind((SumCol10),(SumCol17))
CmbRowS <- rbind(rowSums(ap10), rowSums(ap17))
colours <- c("orange","red")
```

```{r echo=FALSE}
barplot(CmbColS,
        beside=TRUE, 
        las=2, 
        main = "Apprehensions by month",
        cex.lab =1.5,
        col = colours )
legend("topright",
       c("Apprehensions in 2010","Apprehensions in 2017"),
       cex=0.8,
       bty="n",
       fill=colours )
```

## 2010 v.s 2017 Apprehensions by sector
The greatest change has occured in Tuscon, the area with the highest number of apprehensions in the 2010, that observed a drop of over the 80 percent according to the data collected in 2017.
```{r echo=FALSE}
CmbRowS <- rbind(rowSums(ap10), rowSums(ap17))
barplot(CmbRowS,
        beside=TRUE, 
        las=2, main = "Apprehensions by sector", 
        cex.lab =1.5, 
        col = colours )
legend("topleft",
          c("Apprehensions in 2010","Apprehensions in 2017"),
          cex=0.8,
          bty="n",
          fill=colours )
```

## Conclusion (1)
From 2010 to 2017, the U.S. Customs and Border Pro- tection saw an overall 36 percent decrease in individuals apprehended while trying to enter the country illegally.
Taking into consideration the months and the sectors where the apprehensions respectively in 2010 and 2017 occurred, we can see that the change has been charac- terized by a major drop in certain months and certain places rather then by a constant decline everywhere.   

## Simple Statistic Analysis
1) T-test on Tucson observations.
<br> - Ho = mean of the difference between 2010 and 2017.
<br> - 95 percent interval = (9363.28, 19560.89) 
<br> - mean of the difference = 14462.08
<br> - p value = 6.324e − 05

2) T-test on Grande Valley observations.
<br> - Ho = mean of the difference between 2010 and 2017.
<br> - 95 percent interval = (−11201.5621, 572.5621) 
<br> - mean of the difference = −5314.5
<br> - p value = 0.07241

## Time series grapgh 
The number apprehnsions dropped sharply in 2017. Homeland Security Sec,John Kelly, said it was a sign of decreased traffic of illegal immigrants. She also said that this trend indicates Trump's policies and executive actions on immigration are already causing some to stop before coming. 
```{r include=FALSE}
# read data
ts1 <- read.csv("PB monthly summaries_no title.csv")

# arrange the rows in ascending order with columns staring from Jan to Dec
ts2 <- ts1[ nrow(ts1):1, ]
ts2 <- cbind(subset.data.frame(ts2)[,4:12],subset.data.frame(ts2)[,1:3])

# change ts2 to class "ts"
ts3 <- ts(as.vector(unlist(t(ts2))),frequency=12,start=c(2000,1))
```

```{r }
# monthly time series graph from 2000 t0 2017 
ts4 <-ts.plot(ts3, gpars=list(xlab="year", ylab="Apprehensions", lty=c(1:3)))
```

## Time series analysis
Box plot across months will give us a sense on seasonal effect. We can see that the number of apprehension in March has the biggest range and highest median.

```{r echo=FALSE}
# Box plot across months will give us a sense on seasonal effect 
boxplot(ts3~cycle(ts3))
```

## Time series analysis
We can see there is an obvious seasonal fluctuation in the time series graph. A reasonable explanation is because of the weather. The apprehensions tend to decrease during the winter months. 
But the decreasing trend implied that the administration's early efforts to thwart the illegal aliens problems have an effect in the long run. 
```{r echo=FALSE}
# Decompostion of additive time series
timeseriescomponents <- decompose(ts3)
#timeseriescomponents
plot(timeseriescomponents)

```

## Time series prediction
```{r}
fit <- arima(ts3, order=c(1,0,0), list(order=c(2,1,0), period=12))
fore <- predict(fit, n.ahead=24)

#  error bounds at 95% confidence level

U <- fore$pred + 2*fore$se
L <- fore$pred - 2*fore$se
ts.plot(ts3, fore$pred, U, L, col=c(1,2,4,4), lty = c(1,1,2,2))
legend("topleft", c("Actual", "Forecast", "Error Bounds (95% Confidence)"), col=c(1,2,4), lty=c(1,1,2))

```

## Conclusion


